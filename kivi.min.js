var kivi={config:{},_store:{},_reportedMap:{},_startingIntervalSeries:[],get:function(a){return this._store[a]},set:function(a,c){if(this.get(a))this.onError(Error("kivi: You already set key["+a+"] to ["+this.get(a)+"]."));else if("number"!==typeof c)this.onError(Error("kivi: ["+a+"]["+c+"] is not a number."));else this._store[a]=c},isReported:function(a){return!!this._reportedMap[a]},_markReported:function(a){this._reportedMap[a]=!0},clear:function(){this._store={};this._reportedMap={}},onError:function(a){window.console&&
window.console.log&&window.console.log(a.message)},getConfig:function(a){if(this.config[a])return this.config[a];throw Error("kivi: You need to set kivi.config."+a);},postKeys:function(){var a=[];this._.each(this._store,function(c,b){this.isReported(b)||a.push(b)},this);return a},postList:function(a){var c=[];a=a||this.postKeys();this._.each(a,function(a){a={key:a,val:this.get(a)};c.push(a)},this);return c},postData:function(a){return this.postList(a)},post:function(){var a=this,c=this.getConfig("$"),
b=this.getConfig("postUrl"),f=this.getToJSON();if(c&&b&&f){var d=this.postKeys();0<d.length&&(this._.each(d,function(a){this._markReported(a)},this),d=this.postData(d),c.ajax({url:b,type:"POST",data:f(d),contentType:"application/json",success:function(){},error:function(c,b,d){a.onError(Error("kivi: Error posting stats: "+b+" "+d))}}))}},getToJSON:function(){var a;window.JSON&&window.JSON.stringify&&(a=window.JSON.stringify);if(!a){var c=this.getConfig("$");c&&c.toJSON&&(a=c.toJSON)}return a},_setTimer:function(){var a=
this,c=this._startingIntervalSeries.shift();c&&(this._timer=setTimeout(function(){a.post();a._setTimer()},c))},enablePost:function(a){this._startingIntervalSeries=a||[];this._setTimer()},disablePost:function(){this._startingIntervalSeries=null;clearTimeout(this._timer)}};
(function(){var a=Array.prototype.forEach,c={};kivi._={};kivi._.each=function(b,f,d){if(null!=b)if(a&&b.forEach===a)b.forEach(f,d);else if(b.length===+b.length)for(var e=0,g=b.length;e<g&&!(e in b&&f.call(d,b[e],e,b)===c);e++);else for(e in b)if(b.hasOwnProperty.call(b,e)&&f.call(d,b[e],e,b)===c)break}})();
